name: Frontend Deploy (Next.js)

on:
  push:
    branches: [ "main" ]
    paths:
      - 'front-end/**'

jobs:
  deploy-front:
    runs-on: ubuntu-latest
    
    steps:
      - name: ì½”ë“œ ë‚´ë ¤ë°›ê¸°
        uses: actions/checkout@v3

      - name: Node.js ì„¸íŒ…
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
          cache-dependency-path: front-end/package-lock.json

      - name: ì˜ì¡´ì„± ì„¤ì¹˜ & ë¹Œë“œ
        run: |
          cd front-end
          npm ci
          npm run build

      - name: ê²°ê³¼ë¬¼ ì„œë²„ë¡œ ì „ì†¡ (SCP)
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }} 
          password: ${{ secrets.KEY }}
          port: ${{ secrets.PORT }}
          source: "front-end/out/*"
          target: "/var/www/html/life-hub/"
          strip_components: 2

      - name: Discord Notification
        uses: sarisia/actions-status-discord@v1
        if: always()
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          status: ${{ job.status }}
          title: "ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ(Next.js) ë°°í¬ ê²°ê³¼"
          description: "í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­ ë°°í¬ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê²°ê³¼: ${{ job.status }}"
          color: 0x3498db  
          username: GitHub Actions
          avatar_url: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png